#!/bin/sh

set -e

bindir=`dirname $0`

case "$bindir" in
    /usr/bin ) etcdir="/etc" ;;
    /* ) etcdir="../etc" ;;
esac

PVERSION=`basename $0`
PVERSION="${PVERSION#[a-z]*-}"


export LC_ALL=C
export LC_NUMERIC=C


if lsmod | grep -q lustre ; then
 region="VGL"

 LUSTREDATA=/lustre/storeB/project/metproduction/products

 LUSTREDIRFILE=$HOME/.lustredir

 if [ -f "$LUSTREDIRFILE" ] ; then
     read LUSTREDATA < "$LUSTREDIRFILE"
 fi

else
 LUSTREDATA=/opdata

 gw=`route | grep default | awk '{print $2}' `

 case "$gw" in
     vpv*)   region="VV"  ;;
     vnn*)   region="VNN" ;;
     vtk*)   region="VTK" ;;
     *)      region="VA"  ;;
 esac


 if [ $region = "VA" ] ; then

     SUBNET=`/sbin/ifconfig eth0 | grep "inet addr" | cut -d. -f3`

     if [ x"$SUBNET" = "x20" ] ; then
	 region="FOU"
     fi
 fi

fi

export LUSTREDATA=$LUSTREDATA

mkdir -p "$HOME/.tseries"

exec "$bindir/tseries-${PVERSION}.bin" \
    "$@" \
    -S "$region" \
    -s "$etcdir/tseries/${PVERSION}/tseries.ctl" \
    -T tseries
